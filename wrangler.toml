name = "moltbot-sandbox"
main = "src/index.ts"
compatibility_date = "2025-05-06"
compatibility_flags = ["nodejs_compat"]

# Custom domain configuration
routes = [{ pattern = "moltbot.tinman.tools", custom_domain = true }]

# Environment variables
[vars]
DEBUG_ROUTES = true
CF_ACCESS_TEAM_DOMAIN = "tinman-group.cloudflareaccess.com"
CF_ACCESS_AUD = "204c10491d79a48224f685f3e975dbf53545487401535646b63cb11b484a6705"
CF_ACCOUNT_ID = "6719a8f7528223d45d56e2fab188b7b2"
ANTHROPIC_API_KEY = "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"
R2_ACCESS_KEY_ID = "c1653939560e2b173a78d61da10e678d"
R2_SECRET_ACCESS_KEY = "3991881acbd6ec81467654ecbeee3f6a20b65e66ed5d1d66155233bd01a5fae3"
MOLTBOT_GATEWAY_TOKEN = "03dbc61a62639e7854e18f4af64dcd2f737a3d3d0b83c35254d4aa1765a1d6ea"

[observability]
enabled = true

# Static assets for admin UI (built by vite)
[assets]
directory = "./dist/client"
not_found_handling = "single-page-application"
html_handling = "auto-trailing-slash"
binding = "ASSETS"
run_worker_first = true

# Allow importing HTML files as text modules and PNG files as binary
[[rules]]
type = "Text"
globs = ["**/*.html"]
fallthrough = false

[[rules]]
type = "Data"
globs = ["**/*.png"]
fallthrough = false

# Build command for vite
[build]
command = "pnpm run build"

# Container configuration for the Moltbot sandbox
[[containers]]
class_name = "Sandbox"
image = "./Dockerfile"
instance_type = "standard-1"
max_instances = 1

[durable_objects]
bindings = [{ class_name = "Sandbox", name = "Sandbox" }]

[[migrations]]
tag = "v1"
new_sqlite_classes = ["Sandbox"]

# R2 bucket for persistent storage (moltbot data, conversations, etc.)
[[r2_buckets]]
binding = "MOLTBOT_BUCKET"
bucket_name = "moltbot-data"

# Browser Rendering binding for CDP shim
[browser]
binding = "BROWSER"

# Additional secrets that can be configured via `wrangler secret put` or added to [vars]:
#
# AI Provider (alternative to ANTHROPIC_API_KEY set above):
# - OPENAI_API_KEY: Direct OpenAI API key
# - Cloudflare AI Gateway (alternative to direct keys):
#   - CLOUDFLARE_AI_GATEWAY_API_KEY: API key for requests through the gateway
#   - CF_AI_GATEWAY_ACCOUNT_ID: Your Cloudflare account ID
#   - CF_AI_GATEWAY_GATEWAY_ID: Your AI Gateway ID
# - Legacy AI Gateway (still supported):
#   - AI_GATEWAY_API_KEY: API key
#   - AI_GATEWAY_BASE_URL: Gateway endpoint URL
#
# Chat channels (optional):
# - TELEGRAM_BOT_TOKEN, DISCORD_BOT_TOKEN, SLACK_BOT_TOKEN, SLACK_APP_TOKEN
#
# Browser automation (optional):
# - CDP_SECRET: Shared secret for /cdp endpoint authentication
# - WORKER_URL: Public URL of the worker (e.g., https://moltbox.tinman.tools)
#
# Note: The following are already set in [vars] above:
# - ANTHROPIC_API_KEY, MOLTBOT_GATEWAY_TOKEN, R2_ACCESS_KEY_ID, R2_SECRET_ACCESS_KEY
# - CF_ACCESS_TEAM_DOMAIN, CF_ACCESS_AUD, CF_ACCOUNT_ID, DEBUG_ROUTES
